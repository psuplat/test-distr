<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>helloprint</title>
</head>

<body>
    <div style="width:30%;margin:auto;" id="frm-login">
        <form>
            <label for="fld-login">Login:</label><br>
            <input style="width:100%" type="text" placeholder="login" id="fld-login"><br><br>
            <label for="fld-password">Password:</label><br>
            <input style="width:100%" type="password" placeholder="password" id="fld-password"><br><br>
            <button type="button" onclick="login()">LOGIN</button> <button type="button" onclick="showRecover()">RECOVER PASSWORD</button>
        </form>
        <div id="login-feedback"></div>
    </div>
    <div style="width:30%;margin:auto;display:none" id="frm-recover">
        <form>
            <label for="fld-login-recover">Login:</label><br>
            <input style="width:100%" type="text" placeholder="login" id="fld-login-recover"><br><br>
            <button type="button" onclick="recover()">RECOVER</button>
        </form>
        <div id="recovery-feedback"></div>
    </div>
</body>
<script>
    var loginForm = document.getElementById("frm-login");
    var loginRecover = document.getElementById("frm-recover");

    function showRecover() {
        loginForm.style.display = 'none';
        loginRecover.style.display = 'block';
    };

    function login() {
        var l = document.getElementById("fld-login");
        var p = document.getElementById("fld-password");
        var f = document.getElementById("login-feedback");
        


        f.innerHTML = '';
        if(l.value == ''){
            f.innerHTML += '<p style="color:red">login is required!</p>';
        }
        if(p.value == ''){
            f.innerHTML += '<p style="color:red">password is required!</p>';
        }

        if(l.value == '' || p.value == ''){
            return false;
        }

        var data = {"user": l.value, "pass": p.value};

        var xmlhttp = new XMLHttpRequest();

        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == XMLHttpRequest.DONE) {
                if (xmlhttp.status == 200) {
                    var res = JSON.parse(xmlhttp.responseText);
                    if(res.result === true && res.rows > 0)
                    {
                        f.innerHTML = '<p style="color:green">Success!<br>User authenticated</p>';
                    }
                    else if(res.result === true && res.rows == 0)
                    {
                        f.innerHTML = '<p style="color:red">User authentication failed!</p>';
                    }
                    else
                    {
                        f.innerHTML = '<p style="color:red">Error occured!<br>Unable to authenticate user</p>';
                    }
                }
                else {
                    f.innerHTML = '<p style="color:red">Error occured!<br>Response status: '+xmlhttp.status+'</p>';
                }
            }
        };

        xmlhttp.open('POST', 'http://localhost/helloprint/api/login.php', true);
        xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8"); 
        xmlhttp.send(JSON.stringify(data));
    };

    function recover() {
        var l = document.getElementById("fld-login-recover");
        var fr = document.getElementById("recovery-feedback");
        var fl = document.getElementById("login-feedback");
        


        fr.innerHTML = '';
        if(l.value == ''){
            fr.innerHTML += '<p style="color:red">login is required!</p>';
            return false;
        }

        var data = {"user": l.value};

        var xmlhttp = new XMLHttpRequest();

        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == XMLHttpRequest.DONE) {
                if (xmlhttp.status == 200) {
                    var res = JSON.parse(xmlhttp.responseText);
                    if(res.email_result === true)
                    {
                        fl.innerHTML = '<p style="color:green">Success!<br>Message constaining your password has been sent to your email.</p>';
                        fr.innerHTML = '';
                        loginRecover.style.display = 'none';
                        loginForm.style.display = 'block';
                    }
                    else
                    {
                        fr.innerHTML += '<p style="color:red">Error occured!<br>Unable to authenticate user</p>';
                    }
                }
                else {
                    fr.innerHTML += '<p style="color:red">Error occured!<br>Response status: '+xmlhttp.status+'</p>';
                }
            }
        };

        xmlhttp.open('POST', 'http://localhost/helloprint/api/recover.php', true);
        xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8"); 
        xmlhttp.send(JSON.stringify(data));
    };
</script>

</html>
